#!/bin/bash
if [ "x$1" = "x" ]; then
  echo "Error: you forgot to supply a dist name"
  exit 1
fi
DIST=easystroke-$1
echo $DIST

mkdir upload

# tar.gz
darcs dist --dist-name=$DIST
mv $DIST.tar.gz upload

# binary .gz
mkdir build
pushd build
tar -xzf ../upload/$DIST.tar.gz
cd $DIST
make -j2 static
mv easystroke $DIST
gzip $DIST
mv $DIST.gz ../../upload
popd
rm -R build

# .deb
mkdir build
pushd build
tar -xzf ../upload/$DIST.tar.gz
cp ../upload/$DIST.tar.gz easystroke_$1.orig.tar.gz
cd $DIST
chmod +x debian/rules
dpkg-buildpackage -S -sa
cd ..
dput -f thjaeger *.changes
cd $DIST
dpkg-buildpackage -b -j2
cd ..
mv *.deb ../upload
popd
rm -R build

rsync -avP upload/* thjaeger@frs.sourceforge.net:uploads/
rm -R upload
